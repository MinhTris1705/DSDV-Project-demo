<!DOCTYPE html>
<html>
<head>
    <title>Bar Chart for Year 2021 with D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div id="chart"></div>
    <select id="year-dropdown">
      <option value="2017" selected>2017</option>
      <option value="2018">2018</option>
      <option value="2019">2019</option>
      <option value="2020">2020</option>
      <option value="2021" >2021</option>
    </select>
    <script>
        const margin = { top: 10, right: 50, bottom: 80, left: 80 };
        const width = 1000;
        const height = 500;
        const svg = d3.select("#chart")
         .append("svg")
         .attr("width", width)
         .attr("height", height);

        let xScale, yScale, colorScale;

        d3.csv("https://raw.githubusercontent.com/MinhTris1705/DSDV-Project-demo/main/Fertility_rate.csv").then(function(data) {
            const initialYear = "2017";
            const filteredData = data.filter(d => d.Year === initialYear);
            createChart(filteredData);
        });

        d3.select("#year-dropdown")
        .on("change", function() {
            const selectedYear = d3.select(this).property("value");
            updateChart(selectedYear);
          });

        function updateChart(selectedYear) {
          d3.csv("https://raw.githubusercontent.com/MinhTris1705/DSDV-Project-demo/main/Fertility_rate.csv")
          .then(function(data) {
              const filteredData = data.filter(d => d.Year === selectedYear);
              updateScales(filteredData);
              updateBars(filteredData);
            });
        }

        function createChart(data) {
          yScale = d3.scaleBand()
          .domain(data.map(d => d.Entity))
          .range([height - margin.bottom, margin.top])
          .padding(0.1);

          const maxFertilityRate = d3.max(data, d => parseFloat(d["Fertility rate - Sex: all - Age: all - Variant: estimates"]));
          xScale = d3.scaleLinear()
          .domain([0, maxFertilityRate])
          .range([margin.left, width - margin.right]);

          colorScale = d3.scaleOrdinal()
          .domain(data.map(d => d.Entity))
          .range(d3.schemeCategory10);

          svg.selectAll("rect")
          .data(data)
          .enter()
          .append("rect")
          .attr("x", d => margin.left)
          .attr("y", d => yScale(d.Entity))
          .attr("width", d => xScale(parseFloat(d["Fertility rate - Sex: all - Age: all - Variant: estimates"])))
          .attr("height", yScale.bandwidth())
          .attr("fill", d => colorScale(d.Entity));

          svg.append("g")
          .attr("transform", `translate(${margin.left}, 0)`)
          .call(d3.axisLeft(yScale));

          svg.append("g")
          .attr("transform", `translate(0, ${height - margin.bottom})`)
          .call(d3.axisBottom(xScale));
        }

        function updateScales(data) {
          const maxFertilityRate = d3.max(data, d => parseFloat(d["Fertility rate - Sex: all - Age: all - Variant: estimates"]));
          xScale.domain([0, maxFertilityRate]);
          yScale.domain(data.map(d => d.Entity));
        }

        function updateBars(data) {
          const barSelection = svg.selectAll("rect")
          .data(data);

          barSelection.exit().remove();

          barSelection.enter()
          .append("rect")
          .merge(barSelection)
          .attr("x", d => margin.left)
          .attr("y", d => yScale(d.Entity))
          .attr("width", d => xScale(parseFloat(d["Fertility rate - Sex: all - Age: all - Variant: estimates"])))
          .attr("height", yScale.bandwidth())
          .attr("fill", d => colorScale(d.Entity));
        }
    </script>
</body>
</html>

